# nginx/Dockerfile 예시
FROM nginx:alpine

# ARG BACKEND_INSTANCE_MEMBER_1
# ARG BACKEND_INSTANCE_MATCH_1
# ARG BACKEND_INSTANCE_MATCH_2
# ARG FRONT_END_INSTANCE_1

# ENV BACKEND_INSTANCE_MEMBER_1=$BACKEND_INSTANCE_MEMBER_1
# ENV BACKEND_INSTANCE_MATCH_1=$BACKEND_INSTANCE_MATCH_1
# ENV BACKEND_INSTANCE_MATCH_2=$BACKEND_INSTANCE_MATCH_2
# ENV FRONT_END_INSTANCE_1=$FRONT_END_INSTANCE_1

EXPOSE 80 443
COPY ../nginx/deploy/default.conf /etc/nginx/conf.d/default.conf

# CMD /bin/sh -c "envsubst '\$BACKEND_INSTANCE_MEMBER_1 \$BACKEND_INSTANCE_MATCH_1 \$BACKEND_INSTANCE_MATCH_2 \$FRONT_END_INSTANCE_1' < /etc/nginx/conf.d/default.conf > /etc/nginx/conf.d/default.conf && nginx -g 'daemon off;'"

